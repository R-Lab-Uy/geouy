### .png
plot_b <-
ggplot() +
# geom_sf(data = d_s, fill = NA, size = .3, color = "#5796c905") +
geom_sf(data = s_s, fill = NA, size = .2, color = "black") +
theme_void() +
theme(panel.grid.major = element_line(colour = "transparent")) +
#  theme(legend.position = "none") +
annotate("text", x = -54.7, y = -30.8, label = "geouy", color = "black",
size = 25, family = "Roboto", fontface = "bold", angle = -35) # (.png  size = 25)(.svg  size = 6)
sticker(plot_b, package = "",
s_x = 1.03, s_y = 1, s_width = 1.5, s_height = 1.5, # ggplot image size and position
h_fill = "#4dc0d1", h_color = "#4dc0d1", # hexagon
url = "https://github.com/RichDeto/geouy", u_color = "black",
spotlight = T, l_height = 17,
filename = "./man/figures/geouy_logo_b.png", dpi = 400)  # output name and resolution
sticker(plot_a, package = "",
s_x = 1.03, s_y = 1, s_width = 1.5, s_height = 1.5, # ggplot image size and position
h_fill = "black", h_color = "black", # hexagon
url = "https://github.com/RichDeto/geouy", u_color = "#4dc0d1", u_size = 7,
spotlight = T, l_height = 17,
filename = "./man/figures/geouy_logo_a.png", dpi = 400)  # output name and resolution
sticker(plot_a, package = "",
s_x = 1.03, s_y = 1, s_width = 1.5, s_height = 1.5, # ggplot image size and position
h_fill = "black", h_color = "black", # hexagon
url = "https://github.com/RichDeto/geouy", u_color = "#4dc0d1", u_size = 5,
spotlight = T, l_height = 17,
filename = "./man/figures/geouy_logo_a.png", dpi = 400)  # output name and resolution
sticker(plot_a, package = "",
s_x = 1.03, s_y = 1, s_width = 1.5, s_height = 1.5, # ggplot image size and position
h_fill = "black", h_color = "black", # hexagon
url = "https://github.com/RichDeto/geouy", u_color = "#4dc0d1", u_size = 6,
spotlight = T, l_height = 17,
filename = "./man/figures/geouy_logo_a.png", dpi = 400)  # output name and resolution
sticker(plot_a, package = "",
s_x = 1.03, s_y = 1, s_width = 1.5, s_height = 1.5, # ggplot image size and position
h_fill = "black", h_color = "black", # hexagon
url = "https://github.com/RichDeto/geouy", u_color = "#4dc0d1", u_size = 6,
spotlight = T, l_height = 17,
filename = "./man/figures/geouy_logo_a.png", dpi = 400)  # output name and resolution
sticker(plot_b, package = "",
s_x = 1.03, s_y = 1, s_width = 1.5, s_height = 1.5, # ggplot image size and position
h_fill = "#4dc0d1", h_color = "#4dc0d1", # hexagon
url = "https://github.com/RichDeto/geouy", u_color = "black", u_size = 6,
spotlight = T, l_height = 17,
filename = "./man/figures/geouy_logo_b.png", dpi = 400)  # output name and resolution
library(magrittr); library(dplyr)
metadata <- data.frame(
rbind(c("Departamentos", "IDE", "MIDES", 32721, "wfs", 2011,
"https://testmapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:Departamentos%20UY"),
c("Secciones", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Secciones"),
c("Segmentos", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Segmentos"),
c("Zonas", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Zonas"),
c("Localidades_pg", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Localidades_pg"),
c("Asentamientos irregulares", "PMB", "MIDES", 32721, "wfs", 2014,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:ai_pmb_2014"),
c("Balnearios", "MTOP", "MTOP", 4326, "wfs", 2017,
"https://geoservicios.mtop.gub.uy/geoserver/mb_planos/v_balnearios/ows?service=WFS&request=GetFeature&typeName=v_balnearios"),
c("Cursos de agua navegables y flotables", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/cursos_nav_flot/ows?service=WFS&request=GetFeature&typeName=cursos_nav_flot"),
c("Lagunas públicas", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/lagunas_publicas/ows?service=WFS&request=GetFeature&typeName=lagunas_publicas"),
c("Rutas", "IDE", "MIDES", 32721, "wfs", 2017,
"https://testmapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:Carreteras%20Uruguay"),
c("Calles", "IDE - UTE - IM", "MIDES", 32721, "wfs", 2017,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:EjesUruguayUTE,IDE:EjesMontevideoIM"),
c("Peajes", "MTOP", "MTOP", 4326, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/peajes/ows?service=WFS&request=GetFeature&typeName=peajes"),
c("Postes Kilometros", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/postes_km/ows?service=WFS&request=GetFeature&typeName=postes_km")
), stringsAsFactors = FALSE)
names(metadata) <- c("capa","productor","repositor","crs","formato","anio","url")
View(metadata)
x <- geouy::metadata
load_geouy <- function(c, crs = 32721){
x <- geouy::metadata
x <- x[x$capa == c,]
ifelse(x$repositor == "SGM",
st_read("WFS:http://geoservicios.sgm.gub.uy/wfsPCN1000.cgi?",x$url, crs = x$crs),
st_read(x$url, crs = x$crs)) %>%
st_transform(crs)
}
cp <- load_geouy("Centros poblados pg")
library(magrittr)
cp <- load_geouy("Centros poblados pg")
library(sf)
library(dplyr)
cp <- load_geouy("Centros poblados pg")
load_geouy <- function(c, crs = 32721){
x <- geouy::metadata
x <- x[x$capa == c,]
y <- ifelse(x$repositor == "SGM",
st_read("WFS:http://geoservicios.sgm.gub.uy/wfsPCN1000.cgi?",x$url, crs = x$crs),
st_read(x$url, crs = x$crs))
y %>% st_transform(crs)
}
load_geouy <- function(c, crs = 32721){
x <- geouy::metadata
x <- x[x$capa == c,]
y <- ifelse(x$repositor == "SGM",
st_read("WFS:http://geoservicios.sgm.gub.uy/wfsPCN1000.cgi?",x$url, crs = x$crs),
st_read(x$url, crs = x$crs))
y %>% st_transform(crs)
}
cp <- load_geouy("Centros poblados pg")
y <- ifelse(x$repositor %in% "SGM",
st_read("WFS:http://geoservicios.sgm.gub.uy/wfsPCN1000.cgi?",x$url, crs = x$crs),
st_read(x$url, crs = x$crs))
load_geouy <- function(c, crs = 32721){
x <- geouy::metadata
x <- x[x$capa == c,]
y <- ifelse(x$repositor %in% "SGM",
st_read("WFS:http://geoservicios.sgm.gub.uy/wfsPCN1000.cgi?",x$url, crs = x$crs),
st_read(x$url, crs = x$crs))
y %>% st_transform(crs)
}
cp <- load_geouy("Centros poblados pg")
c = "Centros poblados pg"
x <- geouy::metadata
x <- x[x$capa == c,]
x <- geouy::metadata
View(x)
library(magrittr); library(dplyr)
metadata <- data.frame(
rbind(c("Areas administrativas", "SGM", "SGM", 4326, "wfs", 2011, "polnbda_ury"),
c("Departamentos", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimiteDepartamental_wfs_250000/MapServer/WFSServer"),
# c("Departamentos", "IDE", "MIDES", 32721, "wfs", 2011,
#   "https://testmapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:Departamentos%20UY"),
c("Secciones", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Secciones"),
c("Segmentos", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Segmentos"),
c("Zonas", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Zonas"),
c("Localidades_pg", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Localidades_pg"),
# c("Area urbanizada pg", "IGM", "IGM", 4326, "wfs", 2011,
#   "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizada_wfs_20000/MapServer/WFSServer"),
# c("Area urbanizada pt", "IGM", "IGM", 4326, "wfs", 2011,
# "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizadaP_wfs_10000/MapServer/WFSServer"),
c("Centros poblados pg", "SGM", "SGM", 4326, "wfs", 2011, "builtupa"),
c("Centros poblados pt", "SGM", "SGM", 4326, "wfs", 2011, "builtupp"),
c("Municipios", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimitesMunicipales_wfs_250000/MapServer/WFSServer"),
c("Asentamientos irregulares", "PMB", "MIDES", 32721, "wfs", 2014,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:ai_pmb_2014"),
c("Balnearios", "MTOP", "MTOP", 4326, "wfs", 2017,
"https://geoservicios.mtop.gub.uy/geoserver/mb_planos/v_balnearios/ows?service=WFS&request=GetFeature&typeName=v_balnearios"),
c("Cursos de agua navegables y flotables", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/cursos_nav_flot/ows?service=WFS&request=GetFeature&typeName=cursos_nav_flot"),
c("Lagunas públicas", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/lagunas_publicas/ows?service=WFS&request=GetFeature&typeName=lagunas_publicas"),
c("Rutas", "IDE", "MIDES", 32721, "wfs", 2017,
"https://testmapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:Carreteras%20Uruguay"),
c("Calles", "IDE - UTE - IM", "MIDES", 32721, "wfs", 2017,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:EjesUruguayUTE,IDE:EjesMontevideoIM"),
c("Peajes", "MTOP", "MTOP", 4326, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/peajes/ows?service=WFS&request=GetFeature&typeName=peajes"),
c("Postes Kilometros", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/postes_km/ows?service=WFS&request=GetFeature&typeName=postes_km")
), stringsAsFactors = FALSE)
names(metadata) <- c("capa","productor","repositor","crs","formato","anio","url")
metadata %<>% mutate(crs = as.numeric(crs), anio = as.numeric(anio))
saveRDS(metadata,"data-raw/metadata.Rds")
usethis::use_data(metadata, overwrite = TRUE)
x <- geouy::metadata
cp <- load_geouy("Secciones")
load_geouy <- function(c, crs = 32721){
x <- geouy::metadata
x <- x[x$capa == c,]
y <- ifelse(x$repositor %in% "SGM",
st_read("WFS:http://geoservicios.sgm.gub.uy/wfsPCN1000.cgi?",x$url, crs = x$crs),
st_read(x$url, crs = x$crs))
y %>% st_transform(crs)
}
cp <- load_geouy("Secciones")
load_geouy <- function(c, crs = 32721){
x <- geouy::metadata
x <- x[x$capa == c,]
ifelse(x$repositor %in% "SGM",
st_read("WFS:http://geoservicios.sgm.gub.uy/wfsPCN1000.cgi?",x$url, crs = x$crs),
st_read(x$url, crs = x$crs)) %>% st_transform(crs)
}
cp <- load_geouy("Secciones")
x <- x[x$capa == c,]
c= "Secciones"
x <- x[x$capa == c,]
if_else(x$repositor %in% "SGM",
st_read("WFS:http://geoservicios.sgm.gub.uy/wfsPCN1000.cgi?",x$url, crs = x$crs),
st_read(x$url, crs = x$crs)) %>%
st_transform(crs)
library(geouy)
devtools::check_rhub()
devtools::check_rhub()
devtools::check_rhub()
devtools::check_rhub()
install.packages("testthat")
library(testthat)
st_crs(load_geouy("Secciones", crs = 4326))
library(sf)
st_crs(load_geouy("Secciones", crs = 4326))
library(geouy)
st_crs(load_geouy("Secciones", crs = 4326))
a <- load_geouy("Secciones", crs = 4326)
st_crs(a)
crs(a)
epsg
is.na.crs(a)
sf::is.na.crs(a)
is.na(st_crs(a))
testthat::auto_test()
testthat::auto_test("R/plot_geouy.R")
geocode_ide_uy(data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453")))
geocode_ide_uy(data.frame(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"))
x <- data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"))
geocode_ide_uy(x)
class(x$dpto)
geocode_ide_uy(data.frame(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453", stringsAsFactors = F))
x <- data.frame(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453", stringsAsFactors = F)
geocode_ide_uy(x)
a <- geocode_ide_uy(x)
a
stopifnot(is.data.frame(x))
stopifnot(is.character(x$dpto), "dpto" %in% colnames(x), length(x$dpto) >= 1)
stopifnot(is.character(x$loc), "loc" %in% colnames(x))
stopifnot(is.character(x$dir), "dir" %in% colnames(x))
x <- x %>% mutate(dir = str_trim(dir)) %>% filter(nchar(dir) > 0)
library(dplyr)
library(stringi)
library(stringr)
x <- x %>% mutate(dir = str_trim(dir)) %>% filter(nchar(dir) > 0)
for (i in 1:nrow(x)) {
p <- suppressWarnings(readLines(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])))
if (length(p) == 0) {
next
}
x[i,"x"] <- as.numeric(str_sub(p, str_locate(p, "puntoX\":")[2] + 1, str_locate(p, "puntoX\":")[2] + 10))
x[i,"y"] <- as.numeric(str_sub(p, str_locate(p, "puntoY\":")[2] + 1, str_locate(p, "puntoY\":")[2] + 10))
p <- NULL
}
p <- suppressWarnings(readLines(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])))
paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"]))
paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])
p <- suppressWarnings(readLines(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])))
p <- suppressWarnings(readLines(str_replace(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20")))
readLines(str_replace(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20"))
readLines(con = str_replace(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20"))
readLines("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
scan("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
source("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
aa <- source("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
readChar("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
readChar("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453", 1000)
xml2::read_html("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453", 1000)
xml2::read_html("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
xml2::read_xml("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
p <- xml2::read_html("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
as.numeric(str_sub(p, str_locate(p, "puntoX\":")[2] + 1, str_locate(p, "puntoX\":")[2] + 10))
as.numeric(str_sub(p, str_locate(p, "puntoY\":")[2] + 1, str_locate(p, "puntoY\":")[2] + 10))
read_html(str_replace(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20"))
library(xml2)
read_html(str_replace(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20"))
p <- suppressWarnings(read_html(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])))
paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])
p <- suppressWarnings(read_html(str_replace(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20")))
str_replace(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20")
p <- suppressWarnings(read_html(str_replace_all(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20")))
read_html(str_replace_all(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20"))
as.numeric(str_sub(p, str_locate(p, "puntoX\":")[2] + 1, str_locate(p, "puntoX\":")[2] + 10))
geocode_ide_uy <- function(x) {
stopifnot(is.data.frame(x))
stopifnot(is.character(x$dpto), "dpto" %in% colnames(x), length(x$dpto) >= 1)
stopifnot(is.character(x$loc), "loc" %in% colnames(x))
stopifnot(is.character(x$dir), "dir" %in% colnames(x))
x <- x %>% mutate(dir = str_trim(dir)) %>% filter(nchar(dir) > 0)
for (i in 1:nrow(x)) {
p <- suppressWarnings(read_html(str_replace_all(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20")))
if (length(p) == 0) {
next
}
x[i,"x"] <- as.numeric(str_sub(p, str_locate(p, "puntoX\":")[2] + 1, str_locate(p, "puntoX\":")[2] + 10))
x[i,"y"] <- as.numeric(str_sub(p, str_locate(p, "puntoY\":")[2] + 1, str_locate(p, "puntoY\":")[2] + 10))
p <- NULL
}
return(x)
}
x <- data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"))
geocode_ide_uy(x)
x <- data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"), stringsAsFactors = F)
geocode_ide_uy(x)
aaa <- geocode_ide_uy(data.frame(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453", stringsAsFactors = F))
as.vector(aaa)
as.vector(aaa) == c("Montevideo", "Montevideo", "Av. 18 de julio 1453", -56.1849, -34.90519)
as.vector(aaa) == c("Montevideo", "Montevideo", "Av. 18 de julio 1453", "-56.1849", "-34.90519")
aaa[4]
max( aaa[4] )
max(geocode_ide_uy(data.frame(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453", stringsAsFactors = F))[4])
max(geocode_ide_uy(data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"), stringsAsFactors = F))[4])
max(geocode_ide_uy(data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"), stringsAsFactors = F))[4])==-56.1849
56.2-0.0151
round(geocode_ide_uy(data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"), stringsAsFactors = F))[4])
round(geocode_ide_uy(data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"), stringsAsFactors = F))[4], 0)
doc_parce_raw(str_replace_all(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20"))
round(geocode_ide_uy(data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"), stringsAsFactors = F))[4], 0)
nchar("round(geocode_ide_uy(data.frame(cbind(dpto="Montevideo",
loc="Montevideo",
dir="Av. 18 de julio 1453"),
stringsAsFactors = F))[4], 0)")
nchar(´round(geocode_ide_uy(data.frame(cbind(dpto="Montevideo",
loc="Montevideo",
dir="Av. 18 de julio 1453"),
stringsAsFactors = F))[4], 0)´)
library(magrittr); library(dplyr)
metadata <- data.frame(
rbind(c("Areas administrativas", "SGM", "SGM", 4326, "wfs", 2011, "polnbda_ury", NA, NA),
c("Limites departamentales", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimiteDepartamental_wfs_250000/MapServer/WFSServer",
"GLOBALID", "DEPTO"),
c("Departamentos", "IDE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/IDE/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:departamentos",
"uruguay_", "nombre"),
c("Secciones", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Secciones",
"CODSEC","SECCION"),
c("Segmentos", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Segmentos",
"CODSEG","SEGMENTO"),
c("Zonas", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Zonas",
"CODCOMP","ZONA"),
c("Secc MVD 2004", "INE", "MIDES", 32721, "wfs", 2004,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Secciones",
"CODSEC","SECCION"),
c("Segm MVD 2004", "INE", "MIDES", 32721, "wfs", 2004,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Segmentos",
"CODSEG","SEGMENTO"),
c("Zonas MVD 2004", "INE", "MIDES", 32721, "wfs", 2004,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Zonas",
"CODCOMP","ZONA"),
c("Segmentos URB INT 2004", "INE", "MIDES", 32721, "wfs", 2004,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Segmentos",
"CODSEG","SEGMENTO"),
c("Zonas URB INT 2004", "INE", "MIDES", 32721, "wfs", 2004,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Zonas",
"CODCOMP","ZONA"),
c("Localidades pg", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Localidades_pg",
"CODLOC","NOMBLOC"),
c("Localidades pt", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Localidades_pt",
"CODLOC","NOMBLOC"),
# c("Area urbanizada pg", "IGM", "IGM", 4326, "wfs", 2011,
#   "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizada_wfs_20000/MapServer/WFSServer"),
# c("Area urbanizada pt", "IGM", "IGM", 4326, "wfs", 2011,
# "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizadaP_wfs_10000/MapServer/WFSServer"),
c("Centros poblados pg", "SGM", "SGM", 4326, "wfs", 2011, "builtupa", "gml_id", "nam"),
c("Centros poblados pt", "SGM", "SGM", 4326, "wfs", 2011, "builtupp", "gml_id", "nam"),
c("Municipios", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimitesMunicipales_wfs_250000/MapServer/WFSServer",
"OBJECTID_1", "NOMBRE"),
c("Asentamientos irregulares", "PMB", "MIDES", 32721, "wfs", 2014,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:ai_pmb_2014",
"cod_ast", "nom_ast"),
c("Barrios", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:barrios_ine_uy",
"nrobarrio", "nombbarr"),
c("Balnearios", "MTOP", "MTOP", 4326, "wfs", 2017,
"https://geoservicios.mtop.gub.uy/geoserver/mb_planos/v_balnearios/ows?service=WFS&request=GetFeature&typeName=v_balnearios",
"id", "balneario"),
c("Cursos de agua navegables y flotables", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/cursos_nav_flot/ows?service=WFS&request=GetFeature&typeName=cursos_nav_flot",
"gml_id", "nombre"),
c("Lagunas publicas", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/lagunas_publicas/ows?service=WFS&request=GetFeature&typeName=lagunas_publicas",
"gml_id", "nam"),
c("Rutas", "IDE", "MIDES", 32721, "wfs", 2017,
"https://testmapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:Carreteras%20Uruguay",
"numero", "nombre"),
c("Calles", "IDE - UTE - IM", "MIDES", 32721, "wfs", 2017,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:EjesUruguayUTE,IDE:EjesMontevideoIM",
"id", "nombre"),
c("Peajes", "MTOP", "MTOP", 4326, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/peajes/ows?service=WFS&request=GetFeature&typeName=peajes",
"gml_id", "nombre"),
c("Instituciones deportivas", "IDE", "MIDES", 32721, "wfs", 2015,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:inst_deportivas_2015",
"gml_id", "nombre"),
c("Postes Kilometros", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/postes_km/ows?service=WFS&request=GetFeature&typeName=postes_km",
NA,NA)
), stringsAsFactors = FALSE)
names(metadata) <- c("capa","productor","repositor","crs","formato","anio","url","cod","name")
metadata %<>% mutate(crs = as.numeric(crs), anio = as.numeric(anio))
# saveRDS(metadata,"data-raw/metadata.Rds")
usethis::use_data(metadata, overwrite = TRUE)
devtools::submit_cran()
devtools::submit_cran()
library(geouy)
md <- geouy::metadata
try(if (!is(x, "sf")) stop("The object you want to process is not class sf"))
y <- geouy::load_geouy("Uruguay", crs = 4326)
y$geometry <- NULL
x1 <- st_join(x, y)
x <- load_geouy("Peajes", 4326)
b <- which_uy(a,"Departamentos")
try(if (!is(x, "sf")) stop("The object you want to process is not class sf"))
y <- geouy::load_geouy("Uruguay", crs = 4326)
y$geometry <- NULL
x1 <- st_join(x, y)
x2 <- nrow(x1) / nrow(x)
x1 <- sf::st_join(x, y)
x2 <- nrow(x1) / nrow(x)
a <- load_geouy("Peajes")
is.uy4326(a)
library(geouy)
a <- is.uy4326(a)
is.uy4326 <- function(x){
md <- geouy::metadata
try(if (!is(x, "sf")) stop("The object you want to process is not class sf"))
y <- geouy::load_geouy("Uruguay", crs = 4326)
y$geometry <- NULL
x1 <- sf::st_join(x, y, left = F)
x2 <- (nrow(x1) / nrow(x)) * 100
return(ifelse(x2 == 0, "Your object have not any geometry in Uruguay or its CRS is not 4326... Try 32721",
paste0("Your object have ", x2, "% of matches with Ururguay CRS 4326")))
}
a <- is.uy4326(a)
library(geouy)
a <- load_geouy("Peajes")
is.uy4326(a)
a <- load_geouy("Peajes")
expect_error(is.uy4326(a))
testthat::expect_error(is.uy4326(a))
is.uy32721
is.uy32721(a)
is.uy32721 <- function(x){
md <- geouy::metadata
try(if (!is(x, "sf")) stop("The object you want to process is not class sf"))
y <- geouy::load_geouy("Uruguay", crs = 32721)
try(if (st_crs(x) != st_crs(y)) stop("The object you want to process is not at CRS 32721"))
y$geometry <- NULL
x1 <- sf::st_join(x, y, left = F)
x2 <- (nrow(x1) / nrow(x)) * 100
return(ifelse(x2 == 0, "Your object have not any geometry in Uruguay... Try 4326",
paste0("Your object have ", x2, "% of matches with Ururguay CRS 32721")))
}
is.uy32721(a)
expect_equal(is.uy32721(a), "Your object have 100% of matches with Ururguay CRS 32721" )
testthat::expect_equal(is.uy32721(a), "Your object have 100% of matches with Ururguay CRS 32721" )
library(sf)
testthat::expect_equal(is.uy32721(a), "Your object have 100% of matches with Ururguay CRS 32721" )
devtools::submit_cran()
d = c("cod", "name")
!any("full" %in% d)
any("full" %in% d)
d = c("cod", "name", "full")
!any("full" %in% d)
library(geouy)
a <- load_geouy("Peajes")
b <- which_uy(a,"Departamentos")
c <- which_uy(b,"Secciones", d = c("full"))
library(geouy)
c <- which_uy(b,"Secciones", d = c("full"))
dput(names(c))
devtools::submit_cran()
x <- data.frame(cbind(dpto = "Montevideo",
loc = "Montevideo",
dir = "Av. 18 de julio 1453"),
stringsAsFactors = F)
x1 <- geocode_ide_uy(x)
library(geouy)
x1 <- geocode_ide_uy(x)
devtools::submit_cran()
aaa <- st_read("https://visualizador.ide.uy/descargas/Grillas/Urbana/Articulacion_Ortoimagenes_Urbana.shp")
library(sf)
aaa <- st_read("https://visualizador.ide.uy/descargas/Grillas/Urbana/Articulacion_Ortoimagenes_Urbana.shp")
aaa <- st_read(dsn = "https://visualizador.ide.uy/descargas/Grillas/Urbana/", layer = "Articulacion_Ortoimagenes_Urbana.shp")
aaa <- st_read(dsn = "https://visualizador.ide.uy/descargas/Grillas/Urbana/", layer = "Articulacion_Ortoimagenes_Urbana")
aaa <- st_read(list.files("https://visualizador.ide.uy/descargas/Grillas/Urbana/"))
list.files("https://visualizador.ide.uy/descargas/Grillas/Urbana/")
list.files("https://visualizador.ide.uy/descargas/Grillas/Urbana")
aa <- raster::raster("https://visualizador.ide.uy/descargas/CN_Remesa_01/02_Ortoimagenes/03_RGB_8bits/H26D5_RGB_8_Remesa_01.jpg")
plot(aa)
aa <- readJPEG("https://visualizador.ide.uy/descargas/CN_Remesa_01/02_Ortoimagenes/03_RGB_8bits/H26D5_RGB_8_Remesa_01.jpg")
aa <- jpeg::readJPEG("https://visualizador.ide.uy/descargas/CN_Remesa_01/02_Ortoimagenes/03_RGB_8bits/H26D5_RGB_8_Remesa_01.jpg")
a <- raster::stack("https://mapas.ide.uy/geoserver-raster/ows?SERVICE=WMS&format=image/tiff&layers=ortofotos:ortofoto_nacional&crs=EPSG:5381&dpiMode=7&featureCount=10&format=image/tiff&layers=ortofotos:ortofoto_nacional&BBOX:-55.8,-33.5244,-55.74,-33.48")
plot(a[1])
plot(a)
plot(a[[1]])
