"CODSEG","SEGMENTO"),
c("Zonas", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Zonas",
"CODCOMP","ZONA"),
c("Localidades_pg", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Localidades_pg"),
# c("Area urbanizada pg", "IGM", "IGM", 4326, "wfs", 2011,
#   "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizada_wfs_20000/MapServer/WFSServer"),
# c("Area urbanizada pt", "IGM", "IGM", 4326, "wfs", 2011,
# "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizadaP_wfs_10000/MapServer/WFSServer"),
c("Centros poblados pg", "SGM", "SGM", 4326, "wfs", 2011, "builtupa", "gml_id", "nam"),
c("Centros poblados pt", "SGM", "SGM", 4326, "wfs", 2011, "builtupp", "gml_id", "nam"),
c("Municipios", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimitesMunicipales_wfs_250000/MapServer/WFSServer",
"OBJECTID_1", "NOMBRE"),
c("Asentamientos irregulares", "PMB", "MIDES", 32721, "wfs", 2014,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:ai_pmb_2014",
"cod_ast", "nom_ast"),
c("Barrios", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:barrios_ine_uy",
"nrobarrio", "nombbarr"),
c("Balnearios", "MTOP", "MTOP", 4326, "wfs", 2017,
"https://geoservicios.mtop.gub.uy/geoserver/mb_planos/v_balnearios/ows?service=WFS&request=GetFeature&typeName=v_balnearios",
"id", "balneario"),
c("Cursos de agua navegables y flotables", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/cursos_nav_flot/ows?service=WFS&request=GetFeature&typeName=cursos_nav_flot",
"gml_id", "nombre"),
c("Lagunas publicas", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/lagunas_publicas/ows?service=WFS&request=GetFeature&typeName=lagunas_publicas",
"gml_id", "nam"),
c("Rutas", "IDE", "MIDES", 32721, "wfs", 2017,
"https://testmapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:Carreteras%20Uruguay",
"numero", "nombre"),
c("Calles", "IDE - UTE - IM", "MIDES", 32721, "wfs", 2017,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:EjesUruguayUTE,IDE:EjesMontevideoIM",
"id", "nombre"),
c("Peajes", "MTOP", "MTOP", 4326, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/peajes/ows?service=WFS&request=GetFeature&typeName=peajes",
"gml_id", "nombre"),
c("Postes Kilometros", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/postes_km/ows?service=WFS&request=GetFeature&typeName=postes_km",
NA,NA)
), stringsAsFactors = FALSE)
names(metadata) <- c("capa","productor","repositor","crs","formato","anio","url","cod","name")
metadata <- data.frame(
rbind(c("Areas administrativas", "SGM", "SGM", 4326, "wfs", 2011, "polnbda_ury", NA, NA),
c("Limites departamentales", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimiteDepartamental_wfs_250000/MapServer/WFSServer",
"GLOBALID", "DEPTO"),
c("Departamentos", "IDE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/IDE/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:departamentos",
"uruguay_", "nombre"),
c("Secciones", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Secciones",
"CODSEC","SEGMENTO"),
c("Segmentos", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Segmentos",
"CODSEG","SEGMENTO"),
c("Zonas", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Zonas",
"CODCOMP","ZONA"),
c("Localidades_pg", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Localidades_pg"),
# c("Area urbanizada pg", "IGM", "IGM", 4326, "wfs", 2011,
#   "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizada_wfs_20000/MapServer/WFSServer"),
# c("Area urbanizada pt", "IGM", "IGM", 4326, "wfs", 2011,
# "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizadaP_wfs_10000/MapServer/WFSServer"),
c("Centros poblados pg", "SGM", "SGM", 4326, "wfs", 2011, "builtupa", "gml_id", "nam"),
c("Centros poblados pt", "SGM", "SGM", 4326, "wfs", 2011, "builtupp", "gml_id", "nam"),
c("Municipios", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimitesMunicipales_wfs_250000/MapServer/WFSServer",
"OBJECTID_1", "NOMBRE"),
c("Asentamientos irregulares", "PMB", "MIDES", 32721, "wfs", 2014,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:ai_pmb_2014",
"cod_ast", "nom_ast"),
c("Barrios", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:barrios_ine_uy",
"nrobarrio", "nombbarr"),
c("Balnearios", "MTOP", "MTOP", 4326, "wfs", 2017,
"https://geoservicios.mtop.gub.uy/geoserver/mb_planos/v_balnearios/ows?service=WFS&request=GetFeature&typeName=v_balnearios",
"id", "balneario"),
c("Cursos de agua navegables y flotables", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/cursos_nav_flot/ows?service=WFS&request=GetFeature&typeName=cursos_nav_flot",
"gml_id", "nombre"),
c("Lagunas publicas", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/lagunas_publicas/ows?service=WFS&request=GetFeature&typeName=lagunas_publicas",
"gml_id", "nam"),
c("Rutas", "IDE", "MIDES", 32721, "wfs", 2017,
"https://testmapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:Carreteras%20Uruguay",
"numero", "nombre"),
c("Calles", "IDE - UTE - IM", "MIDES", 32721, "wfs", 2017,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:EjesUruguayUTE,IDE:EjesMontevideoIM",
"id", "nombre"),
c("Peajes", "MTOP", "MTOP", 4326, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/peajes/ows?service=WFS&request=GetFeature&typeName=peajes",
"gml_id", "nombre"),
c("Postes Kilometros", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/postes_km/ows?service=WFS&request=GetFeature&typeName=postes_km",
NA,NA)
), stringsAsFactors = FALSE)
rm(metadata)
metadata <- data.frame(
rbind(c("Areas administrativas", "SGM", "SGM", 4326, "wfs", 2011, "polnbda_ury", NA, NA),
c("Limites departamentales", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimiteDepartamental_wfs_250000/MapServer/WFSServer",
"GLOBALID", "DEPTO"),
c("Departamentos", "IDE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/IDE/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:departamentos",
"uruguay_", "nombre"),
c("Secciones", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Secciones",
"CODSEC","SEGMENTO"),
c("Segmentos", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Segmentos",
"CODSEG","SEGMENTO"),
c("Zonas", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Zonas",
"CODCOMP","ZONA"),
c("Localidades_pg", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Localidades_pg"),
# c("Area urbanizada pg", "IGM", "IGM", 4326, "wfs", 2011,
#   "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizada_wfs_20000/MapServer/WFSServer"),
# c("Area urbanizada pt", "IGM", "IGM", 4326, "wfs", 2011,
# "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizadaP_wfs_10000/MapServer/WFSServer"),
c("Centros poblados pg", "SGM", "SGM", 4326, "wfs", 2011, "builtupa", "gml_id", "nam"),
c("Centros poblados pt", "SGM", "SGM", 4326, "wfs", 2011, "builtupp", "gml_id", "nam"),
c("Municipios", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimitesMunicipales_wfs_250000/MapServer/WFSServer",
"OBJECTID_1", "NOMBRE"),
c("Asentamientos irregulares", "PMB", "MIDES", 32721, "wfs", 2014,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:ai_pmb_2014",
"cod_ast", "nom_ast"),
c("Barrios", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:barrios_ine_uy",
"nrobarrio", "nombbarr"),
c("Balnearios", "MTOP", "MTOP", 4326, "wfs", 2017,
"https://geoservicios.mtop.gub.uy/geoserver/mb_planos/v_balnearios/ows?service=WFS&request=GetFeature&typeName=v_balnearios",
"id", "balneario"),
c("Cursos de agua navegables y flotables", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/cursos_nav_flot/ows?service=WFS&request=GetFeature&typeName=cursos_nav_flot",
"gml_id", "nombre"),
c("Lagunas publicas", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/lagunas_publicas/ows?service=WFS&request=GetFeature&typeName=lagunas_publicas",
"gml_id", "nam"),
c("Rutas", "IDE", "MIDES", 32721, "wfs", 2017,
"https://testmapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:Carreteras%20Uruguay",
"numero", "nombre"),
c("Calles", "IDE - UTE - IM", "MIDES", 32721, "wfs", 2017,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:EjesUruguayUTE,IDE:EjesMontevideoIM",
"id", "nombre"),
c("Peajes", "MTOP", "MTOP", 4326, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/peajes/ows?service=WFS&request=GetFeature&typeName=peajes",
"gml_id", "nombre"),
c("Postes Kilometros", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/postes_km/ows?service=WFS&request=GetFeature&typeName=postes_km",
NA,NA)
), stringsAsFactors = FALSE)
View(metadata)
names(metadata) <- c("capa","productor","repositor","crs","formato","anio","url","cod","name")
metadata %<>% mutate(crs = as.numeric(crs), anio = as.numeric(anio))
# saveRDS(metadata,"data-raw/metadata.Rds")
usethis::use_data(metadata, overwrite = TRUE)
library(magrittr); library(dplyr)
metadata <- data.frame(
rbind(c("Areas administrativas", "SGM", "SGM", 4326, "wfs", 2011, "polnbda_ury", NA, NA),
c("Limites departamentales", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimiteDepartamental_wfs_250000/MapServer/WFSServer",
"GLOBALID", "DEPTO"),
c("Departamentos", "IDE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/IDE/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:departamentos",
"uruguay_", "nombre"),
c("Secciones", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Secciones",
"CODSEC","SEGMENTO"),
c("Segmentos", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Segmentos",
"CODSEG","SEGMENTO"),
c("Zonas", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Zonas",
"CODCOMP","ZONA"),
c("Localidades_pg", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Localidades_pg"),
# c("Area urbanizada pg", "IGM", "IGM", 4326, "wfs", 2011,
#   "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizada_wfs_20000/MapServer/WFSServer"),
# c("Area urbanizada pt", "IGM", "IGM", 4326, "wfs", 2011,
# "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizadaP_wfs_10000/MapServer/WFSServer"),
c("Centros poblados pg", "SGM", "SGM", 4326, "wfs", 2011, "builtupa", "gml_id", "nam"),
c("Centros poblados pt", "SGM", "SGM", 4326, "wfs", 2011, "builtupp", "gml_id", "nam"),
c("Municipios", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimitesMunicipales_wfs_250000/MapServer/WFSServer",
"OBJECTID_1", "NOMBRE"),
c("Asentamientos irregulares", "PMB", "MIDES", 32721, "wfs", 2014,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:ai_pmb_2014",
"cod_ast", "nom_ast"),
c("Barrios", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:barrios_ine_uy",
"nrobarrio", "nombbarr"),
c("Balnearios", "MTOP", "MTOP", 4326, "wfs", 2017,
"https://geoservicios.mtop.gub.uy/geoserver/mb_planos/v_balnearios/ows?service=WFS&request=GetFeature&typeName=v_balnearios",
"id", "balneario"),
c("Cursos de agua navegables y flotables", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/cursos_nav_flot/ows?service=WFS&request=GetFeature&typeName=cursos_nav_flot",
"gml_id", "nombre"),
c("Lagunas publicas", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/lagunas_publicas/ows?service=WFS&request=GetFeature&typeName=lagunas_publicas",
"gml_id", "nam"),
c("Rutas", "IDE", "MIDES", 32721, "wfs", 2017,
"https://testmapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:Carreteras%20Uruguay",
"numero", "nombre"),
c("Calles", "IDE - UTE - IM", "MIDES", 32721, "wfs", 2017,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:EjesUruguayUTE,IDE:EjesMontevideoIM",
"id", "nombre"),
c("Peajes", "MTOP", "MTOP", 4326, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/peajes/ows?service=WFS&request=GetFeature&typeName=peajes",
"gml_id", "nombre"),
c("Postes Kilometros", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/postes_km/ows?service=WFS&request=GetFeature&typeName=postes_km",
NA,NA)
), stringsAsFactors = FALSE)
names(metadata) <- c("capa","productor","repositor","crs","formato","anio","url","cod","name")
metadata %<>% mutate(crs = as.numeric(crs), anio = as.numeric(anio))
# saveRDS(metadata,"data-raw/metadata.Rds")
usethis::use_data(metadata, overwrite = TRUE)
a <- load_geouy("Peajes")
b <- which_uy(a,"Departamentos")
which_uy <- function(x, c = c("Localidades pg", "Departamentos"), d = c("cod", "name"), crs = 32721){
md <- geouy::metadata
try(if (!is(x, "sf")) stop("The object you want to process is not class sf"))
try(if (st_crs(x) == crs) stop("The object you want to process is not in the same crs with the homonym parameter"))
try(if (!c %in% x$capa) stop("The name of the geometry you will load is not correct. Verify in the metadata file"))
md <- md[md$capa %in% c,]
for (i in c) {
y <- geouy::load_geouy(c[i], crs = crs)
y2 <- y[ ,md[ , d]]
for (j in 1:length(d)) {
names(y2)[j] <- paste0(d[j], "_", i)
}
x <- st_join(x, y2)
}
return(x)
}
b <- which_uy(a,"Departamentos")
library(sf)
library(dplyr)
library(methods)
b <- which_uy(a,"Departamentos")
md <- geouy::metadata
x=a
!is(x, "sf")
st_crs(x) == crs
crs = 32721
st_crs(x) == crs
st_crs(x)
st_crs(32721)
st_crs(4326)
st_crs(crs)
st_crs(x) == st_crs(crs)
!st_crs(x) == st_crs(crs)
!c %in% x$capa
!c %in% md$capa
md$capa
c
c = c("Localidades pg", "Departamentos")
!c %in% md$capa
c %in% md$capa
c = c("Localidades_pg", "Departamentos")
!c %in% md$capa
sum(!c %in% md$capa)
sum(!c %in% md$capa) > 0
md <- md[md$capa %in% c,]
for (i in c) {
y <- geouy::load_geouy(c[i], crs = crs)
y2 <- y[ ,md[ , d]]
for (j in 1:length(d)) {
names(y2)[j] <- paste0(d[j], "_", i)
}
x <- st_join(x, y2)
}
for (i in c) {
y <- geouy::load_geouy(i, crs = crs)
y2 <- y[ ,md[ , d]]
for (j in 1:length(d)) {
names(y2)[j] <- paste0(d[j], "_", i)
}
x <- st_join(x, y2)
}
d = c("cod", "name")
for (i in c) {
y <- geouy::load_geouy(i, crs = crs)
y2 <- y[ ,md[ , d]]
for (j in 1:length(d)) {
names(y2)[j] <- paste0(d[j], "_", i)
}
x <- st_join(x, y2)
}
y <- geouy::load_geouy(i, crs = crs)
y2 <- y[ ,md[ , d]]
y2 <- y[ ,md[ md$capa == i, d]]
md[ md$capa == i, d]
md[md$capa == i,
]
md <- geouy::metadata
library(magrittr); library(dplyr)
metadata <- data.frame(
rbind(c("Areas administrativas", "SGM", "SGM", 4326, "wfs", 2011, "polnbda_ury", NA, NA),
c("Limites departamentales", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimiteDepartamental_wfs_250000/MapServer/WFSServer",
"GLOBALID", "DEPTO"),
c("Departamentos", "IDE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/IDE/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:departamentos",
"uruguay_", "nombre"),
c("Secciones", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Secciones",
"CODSEC","SEGMENTO"),
c("Segmentos", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Segmentos",
"CODSEG","SEGMENTO"),
c("Zonas", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Zonas",
"CODCOMP","ZONA"),
c("Localidades_pg", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Localidades_pg"),
# c("Area urbanizada pg", "IGM", "IGM", 4326, "wfs", 2011,
#   "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizada_wfs_20000/MapServer/WFSServer"),
# c("Area urbanizada pt", "IGM", "IGM", 4326, "wfs", 2011,
# "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizadaP_wfs_10000/MapServer/WFSServer"),
c("Centros poblados pg", "SGM", "SGM", 4326, "wfs", 2011, "builtupa", "gml_id", "nam"),
c("Centros poblados pt", "SGM", "SGM", 4326, "wfs", 2011, "builtupp", "gml_id", "nam"),
c("Municipios", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimitesMunicipales_wfs_250000/MapServer/WFSServer",
"OBJECTID_1", "NOMBRE"),
c("Asentamientos irregulares", "PMB", "MIDES", 32721, "wfs", 2014,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:ai_pmb_2014",
"cod_ast", "nom_ast"),
c("Barrios", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:barrios_ine_uy",
"nrobarrio", "nombbarr"),
c("Balnearios", "MTOP", "MTOP", 4326, "wfs", 2017,
"https://geoservicios.mtop.gub.uy/geoserver/mb_planos/v_balnearios/ows?service=WFS&request=GetFeature&typeName=v_balnearios",
"id", "balneario"),
c("Cursos de agua navegables y flotables", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/cursos_nav_flot/ows?service=WFS&request=GetFeature&typeName=cursos_nav_flot",
"gml_id", "nombre"),
c("Lagunas publicas", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/lagunas_publicas/ows?service=WFS&request=GetFeature&typeName=lagunas_publicas",
"gml_id", "nam"),
c("Rutas", "IDE", "MIDES", 32721, "wfs", 2017,
"https://testmapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:Carreteras%20Uruguay",
"numero", "nombre"),
c("Calles", "IDE - UTE - IM", "MIDES", 32721, "wfs", 2017,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:EjesUruguayUTE,IDE:EjesMontevideoIM",
"id", "nombre"),
c("Peajes", "MTOP", "MTOP", 4326, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/peajes/ows?service=WFS&request=GetFeature&typeName=peajes",
"gml_id", "nombre"),
c("Postes Kilometros", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/postes_km/ows?service=WFS&request=GetFeature&typeName=postes_km",
NA,NA)
), stringsAsFactors = FALSE)
names(metadata) <- c("capa","productor","repositor","crs","formato","anio","url","cod","name")
metadata %<>% mutate(crs = as.numeric(crs), anio = as.numeric(anio))
# saveRDS(metadata,"data-raw/metadata.Rds")
usethis::use_data(metadata, overwrite = TRUE)
md <- geouy::metadata
md <- metadata
y2 <- y[ ,md[md$capa == i, d]]
md[md$capa == i, d]
as.character(md[md$capa == i, d])
c(md[md$capa == i, d])
y2 <- y[ , as.character(md[md$capa == i, d])]
y2 <- y[ , c(as.character(md[md$capa == i, d]))]
!!sym(md[md$capa == i, d])
!!(md[md$capa == i, d])
unquo(md[md$capa == i, d])
library(dplyr)
unquo(md[md$capa == i, d])
enquo(md[md$capa == i, d])
quo_name(md[md$capa == i, d])
aaa <- enquo(md[md$capa == i, d][1]
)
y2 <- y[ , as.vector(md[md$capa == i, d])]
as.vector(md[md$capa == i, d])
class(as.vector(md[md$capa == i, d]))
class(as.array(md[md$capa == i, d]))
aaa <- md[md$capa == i, d]
View(aaa)
aaa <- md[md$capa == i, c(d)]
md2 <- md %>%
filter(capa == i) %>%
select(d)
View(md)
library(magrittr); library(dplyr)
metadata <- data.frame(
rbind(c("Areas administrativas", "SGM", "SGM", 4326, "wfs", 2011, "polnbda_ury", NA, NA),
c("Limites departamentales", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimiteDepartamental_wfs_250000/MapServer/WFSServer",
"GLOBALID", "DEPTO"),
c("Departamentos", "IDE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/IDE/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:departamentos",
"uruguay_", "nombre"),
c("Secciones", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Secciones",
"CODSEC","SEGMENTO"),
c("Segmentos", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Segmentos",
"CODSEG","SEGMENTO"),
c("Zonas", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Zonas",
"CODCOMP","ZONA"),
c("Localidades_pg", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Localidades_pg",
"CODLOC","NOMBLOC"),
# c("Area urbanizada pg", "IGM", "IGM", 4326, "wfs", 2011,
#   "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizada_wfs_20000/MapServer/WFSServer"),
# c("Area urbanizada pt", "IGM", "IGM", 4326, "wfs", 2011,
# "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizadaP_wfs_10000/MapServer/WFSServer"),
c("Centros poblados pg", "SGM", "SGM", 4326, "wfs", 2011, "builtupa", "gml_id", "nam"),
c("Centros poblados pt", "SGM", "SGM", 4326, "wfs", 2011, "builtupp", "gml_id", "nam"),
c("Municipios", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimitesMunicipales_wfs_250000/MapServer/WFSServer",
"OBJECTID_1", "NOMBRE"),
c("Asentamientos irregulares", "PMB", "MIDES", 32721, "wfs", 2014,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:ai_pmb_2014",
"cod_ast", "nom_ast"),
c("Barrios", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:barrios_ine_uy",
"nrobarrio", "nombbarr"),
c("Balnearios", "MTOP", "MTOP", 4326, "wfs", 2017,
"https://geoservicios.mtop.gub.uy/geoserver/mb_planos/v_balnearios/ows?service=WFS&request=GetFeature&typeName=v_balnearios",
"id", "balneario"),
c("Cursos de agua navegables y flotables", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/cursos_nav_flot/ows?service=WFS&request=GetFeature&typeName=cursos_nav_flot",
"gml_id", "nombre"),
c("Lagunas publicas", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/lagunas_publicas/ows?service=WFS&request=GetFeature&typeName=lagunas_publicas",
"gml_id", "nam"),
c("Rutas", "IDE", "MIDES", 32721, "wfs", 2017,
"https://testmapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:Carreteras%20Uruguay",
"numero", "nombre"),
c("Calles", "IDE - UTE - IM", "MIDES", 32721, "wfs", 2017,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:EjesUruguayUTE,IDE:EjesMontevideoIM",
"id", "nombre"),
c("Peajes", "MTOP", "MTOP", 4326, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/peajes/ows?service=WFS&request=GetFeature&typeName=peajes",
"gml_id", "nombre"),
c("Postes Kilometros", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/postes_km/ows?service=WFS&request=GetFeature&typeName=postes_km",
NA,NA)
), stringsAsFactors = FALSE)
names(metadata) <- c("capa","productor","repositor","crs","formato","anio","url","cod","name")
metadata %<>% mutate(crs = as.numeric(crs), anio = as.numeric(anio))
# saveRDS(metadata,"data-raw/metadata.Rds")
usethis::use_data(metadata, overwrite = TRUE)
md <- metadata
md <- md[md$capa %in% c,]
md2 <- md %>%
filter(capa == i) %>%
select(d)
y2 <- y select(md2)
y2 <- y %>% select(md2)
y2 <- y %>% select(as.character(md2))
which_uy <- function(x, c = c("Localidades_pg", "Departamentos"), d = c("cod", "name"), crs = 32721){
md <- geouy::metadata
try(if (!is(x, "sf")) stop("The object you want to process is not class sf"))
try(if (st_crs(x) != st_crs(crs)) stop("The object you want to process is not in the same crs with the homonym parameter"))
try(if (sum(!c %in% md$capa) > 0) stop("The name of the geometry you will load is not correct. Verify in the metadata file"))
md <- md[md$capa %in% c,]
for (i in c) {
y <- geouy::load_geouy(i, crs = crs)
md2 <- md %>%
filter(capa == i) %>%
select(d)
y2 <- y %>% select(as.character(md2))
# for (j in 1:length(d)) {
#   names(y2)[j] <- paste0(d[j], "_", i)
# }
x <- st_join(x, y2)
}
return(x)
}
a <- load_geouy("Peajes")
b <- which_uy(a,"Departamentos")
load("C:/Users/rdetomasi/Desktop/R/GeoUy/data/metadata.rda")
md <- geouy::metadata
library(geouy)
md <- geouy::metadata
b <- which_uy(a,"Departamentos")
devtools::document()
a <- load_geouy("Peajes")
library(geouy)
a <- load_geouy("Peajes")
b <- which_uy(a,"Departamentos")
a1 <- sf::st_crs(b)
expect_equal(a1[1], structure(list(epsg = 32721L), .Names = "epsg"))
testthat::expect_equal(a1[1], structure(list(epsg = 32721L), .Names = "epsg"))
testthat::expect_is(b, "sf")
x <- data.frame(cbind(dpto = "Montevideo",
loc = "Montevideo",
dir = "Av. 18 de julio 1453")
x <- data.frame(cbind(dpto = "Montevideo",
loc = "Montevideo",
dir = "Av. 18 de julio 1453"),
stringsAsFactors = F)
x <- data.frame(cbind(dpto = "Montevideo",
loc = "Montevideo",
dir = "Av. 18 de julio 1453"),
stringsAsFactors = F)
x1 <- geocode_ide_uy(x)
library(testthat)
expect_equal(x1[4], structure(list(x = -56.184901), .Names = "x", row.names = c(NA, -1L), class = "data.frame"))
expect_equal(x1[5], structure(list(y = -34.905193), .Names = "y", row.names = c(NA, -1L), class = "data.frame"))
usethis::use_vignette("geouy", "Ejemplo de uso del paquete `geouy`")
